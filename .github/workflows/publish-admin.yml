name: Public Admin

on:
  push:
    branches: [main]

jobs:
  publish:
    runs-on: ubuntu-latest

    name: "publish npm"

    environment: npm

    steps:
      - uses: actions/checkout@master
      - uses: pnpm/action-setup@v2.1.0
        with:
          version: 7.2.1
      - name: Install modules
        run: cd packages/admin && pnpm install
      - name: Build
        run: cd packages/admin && pnpm run build
      - name: Deploy to Aliyun
        uses: easingthemes/ssh-deploy@v2.1.1
        env:
          SSH_PRIVATE_KEY: ${{ secrets.ACCESS_TOKEN }}
          ARGS: "-avzr --delete"
          SOURCE: "packages/admin/dist"
          REMOTE_HOST: "47.98.252.43"
          REMOTE_USER: "root"
          TARGET: "/root/source/react-arco-admin/packages/admin"
